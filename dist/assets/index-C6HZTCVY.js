import{i as le,B as Ve,a as ke,p as _,r as s,b as C,t as u,c as k,I as be,d as Fe,e as Se,f as Ne,g as Te,h as Ee,j as Ae,k as ue,q as He,l as t,Z as Ye,s as F,m as re,n as A,u as me,Q as Z,S as D,D as Ge,o as $,v as E,T as pe,w as $e,x as Pe,y as Ze,F as ce,z as U,A as ne,C as _e,E as We,G as Be,H as Qe,J as ze,K as Ue,L as Je,M as Ke,N as qe,O as Xe,R as et}from"./vendor-C_OQZK9Z.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const y of a.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&l(y)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const tt="Type & Data",at="Data Source",ot="Data Range",nt="Date Filtering",st="Date",lt="Create Date",rt="Modify Date",ct="Basis",it="Range",dt="Today",ut="Yesterday",mt="Current Week",yt="Last Week",ht="Current Month",ft="Last Month",pt="Current Quarter",Ct="Last Quarter",gt="Current Year",xt="Last Year",wt="Last 7 Days",vt="Last 14 Days",It="Last 30 Days",bt="Last 365 Days",Yt="Last 3 Months",$t="Last 6 Months",Mt="Statistical Methods",Lt="Total Records Count",Rt="Field Value Count",jt="Number",Dt="Currency",Ot="Sum",Vt="Average",kt="Max",Ft="Min",St="MoM & YoY",Nt="Add MoM & YoY",Tt="Description",Et="Calculation Method",At="MoM",Ht="Week YoY",Gt="Month YoY",Pt="Year YoY",Zt="Calculation Type",_t="MoM Growth Rate",Wt="MoM Growth Value",Bt="MoM Original Value",Qt="Week YoY Growth Value",zt="Month YoY Growth Value",Ut="Year YoY Growth Value",Jt="Week YoY Original Value",Kt="Month YoY Original Value",qt="Year YoY Original Value",Xt="Week YoY Growth Rate",ea="Month YoY Growth Rate",ta="Year YoY Growth Rate",aa="Growth Value",oa="Growth Rate",na="Difference Rate",sa="Difference Value",la="Original Value",ra="Custom Style",ca="Color",ia="Icon Style",da="Index Data Format",ua="Decimal Places & Format",ma="Number (Thousands Separator)",ya="Percentage",ha="Per Mille",fa="Prefix",pa="Suffix",Ca="Please enter a prefix",ga="Please enter a suffix",xa="Please select a data field",wa="Only positive integers are allowed",va="All Data",Ia="Confirm",ba={type_Date:tt,dataSource:at,dataRange:ot,dateFiltering:nt,date:st,createDate:lt,ModifyDate:rt,basis:ct,range:it,today:dt,yesterday:ut,currentWeek:mt,lastWeek:yt,currentMonth:ht,lastMonth:ft,currentQuarter:pt,lastQuarter:Ct,currentYear:gt,lastYear:xt,last7Days:wt,last14Days:vt,last30Days:It,last365Days:bt,last3Months:Yt,last6Months:$t,statisticalMethods:Mt,recordsTotal:Lt,fieldValue:Rt,number:jt,currency:Dt,sum:Ot,average:Vt,max:kt,min:Ft,mom_yoy:St,addMom_Yoy:Nt,description:Tt,calculation:Et,mom:At,weekYoy:Ht,monthYoy:Gt,yearYoy:Pt,calculationType:Zt,momGrowthRate:_t,momGrowthValue:Wt,momOriginalValue:Bt,weekYoyGrowthValue:Qt,monthYoyGrowthValue:zt,yearYoyGrowthValue:Ut,weekYoyOriginalValue:Jt,monthYoyOriginalValue:Kt,yearYoyOriginalValue:qt,weekYoyGrowthRate:Xt,monthYoyGrowthRate:ea,yearYoyGrowthRate:ta,growthValue:aa,growthRate:oa,differenceRate:na,differenceValue:sa,originalValue:la,customStyle:ra,color:ca,iconStyle:ia,indexDataFormat:da,decimalPlaces_Format:ua,numberMillennials:ma,percentage:ya,millageRate:ha,prefix:fa,suffix:pa,prefixPlaceholder:Ca,suffixPlaceholder:ga,dataPlaceholder:xa,formatErrorMessage:wa,allData:va,confirm:Ia},Ya="类型与数据",$a="数据源",Ma="数据范围",La="日期筛选",Ra="日期",ja="创建日期",Da="修改日期",Oa="依据",Va="范围",ka="今天",Fa="昨天",Sa="本周",Na="上周",Ta="本月",Ea="上月",Aa="本季度",Ha="上季度",Ga="今年",Pa="去年",Za="最近7天",_a="最近14天",Wa="最近30天",Ba="最近365天",Qa="最近3个月",za="最近6个月",Ua="查看全部",Ja="主要指标",Ka="辅助指标",qa="添加指标",Xa="字段",eo="统计方式",to="统计记录总数",ao="统计字段数值",oo="数字",no="货币",so="求和",lo="平均值",ro="最大值",co="最小值",io="环同比",uo="添加环同比",mo="描述",yo="计算方式",ho="环比",fo="周同比",po="月同比",Co="年同比",go="计算类型",xo="环比增长率",wo="环比增长值",vo="环比原始值",Io="周同比增长值",bo="月同比增长值",Yo="年同比增长值",$o="周同比原始值",Mo="月同比原始值",Lo="年同比原始值",Ro="周同比增长率",jo="月同比增长率",Do="年同比增长率",Oo="增长值",Vo="增长率",ko="差异率",Fo="差异值",So="原始值",No="自定义样式",To="颜色",Eo="图标样式",Ao="指标数据格式",Ho="小数位与格式",Go="数字（千分位）",Po="百分比",Zo="千分比",_o="前缀",Wo="后缀",Bo="请输入前缀",Qo="请输入后缀",zo="请选择指标字段",Uo="仅允许输入大于零的整数",Jo="全部数据",Ko="确定",qo={type_Date:Ya,dataSource:$a,dataRange:Ma,dateFiltering:La,date:Ra,createDate:ja,ModifyDate:Da,basis:Oa,range:Va,today:ka,yesterday:Fa,currentWeek:Sa,lastWeek:Na,currentMonth:Ta,lastMonth:Ea,currentQuarter:Aa,lastQuarter:Ha,currentYear:Ga,lastYear:Pa,last7Days:Za,last14Days:_a,last30Days:Wa,last365Days:Ba,last3Months:Qa,last6Months:za,view_all:Ua,key_indicators:Ja,auxiliary_index:Ka,add_index:qa,field:Xa,statisticalMethods:eo,recordsTotal:to,fieldValue:ao,number:oo,currency:no,sum:so,average:lo,max:ro,min:co,mom_yoy:io,addMom_Yoy:uo,description:mo,calculation:yo,mom:ho,weekYoy:fo,monthYoy:po,yearYoy:Co,calculationType:go,momGrowthRate:xo,momGrowthValue:wo,momOriginalValue:vo,weekYoyGrowthValue:Io,monthYoyGrowthValue:bo,yearYoyGrowthValue:Yo,weekYoyOriginalValue:$o,monthYoyOriginalValue:Mo,yearYoyOriginalValue:Lo,weekYoyGrowthRate:Ro,monthYoyGrowthRate:jo,yearYoyGrowthRate:Do,growthValue:Oo,growthRate:Vo,differenceRate:ko,differenceValue:Fo,originalValue:So,customStyle:No,color:To,iconStyle:Eo,indexDataFormat:Ao,decimalPlaces_Format:Ho,numberMillennials:Go,percentage:Po,millageRate:Zo,prefix:_o,suffix:Wo,prefixPlaceholder:Bo,suffixPlaceholder:Qo,dataPlaceholder:zo,formatErrorMessage:Uo,allData:Jo,confirm:Ko},Xo="タイプとデータ",en="データソース",tn="データ範囲",an="日付フィルタリング",on="日付",nn="作成日",sn="更新日",ln="根拠",rn="範囲",cn="今日",dn="昨日",un="今週",mn="先週",yn="今月",hn="先月",fn="今四半期",pn="前四半期",Cn="今年",gn="去年",xn="過去7日間",wn="過去14日間",vn="過去30日間",In="過去365日間",bn="過去3ヶ月",Yn="過去6ヶ月",$n="統計手法",Mn="総レコード数",Ln="フィールド数値の集計",Rn="数字",jn="通貨",Dn="合計",On="平均値",Vn="最大値",kn="最小値",Fn="環境比と同期比",Sn="追加環境比と同期比",Nn="説明",Tn="計算方法",En="環境比",An="週同期比",Hn="月同期比",Gn="年同期比",Pn="計算タイプ",Zn="環境比成長率",_n="環境比成長値",Wn="環境比原始値",Bn="週同期比成長値",Qn="月同期比成長値",zn="年同期比成長値",Un="週同期比原始値",Jn="月同期比原始値",Kn="年同期比原始値",qn="週同期比成長率",Xn="月同期比成長率",es="年同期比成長率",ts="成長値",as="成長率",os="差異率",ns="差異値",ss="原始値",ls="カスタムスタイル",rs="色",cs="アイコンスタイル",is="指標データフォーマット",ds="小数点以下の桁数とフォーマット",us="数字（千分位）",ms="パーセンテージ",ys="パーミレ（千分率）",hs="接頭辞",fs="接尾辞",ps="接頭辞を入力してください",Cs="接尾辞を入力してください",gs="日付フィールドを選択してください",xs="正の整数のみが許可されます",ws="全てのデータ",vs="確定",Is={type_Date:Xo,dataSource:en,dataRange:tn,dateFiltering:an,date:on,createDate:nn,ModifyDate:sn,basis:ln,range:rn,today:cn,yesterday:dn,currentWeek:un,lastWeek:mn,currentMonth:yn,lastMonth:hn,currentQuarter:fn,lastQuarter:pn,currentYear:Cn,lastYear:gn,last7Days:xn,last14Days:wn,last30Days:vn,last365Days:In,last3Months:bn,last6Months:Yn,statisticalMethods:$n,recordsTotal:Mn,fieldValue:Ln,number:Rn,currency:jn,sum:Dn,average:On,max:Vn,min:kn,mom_yoy:Fn,addMom_Yoy:Sn,description:Nn,calculation:Tn,mom:En,weekYoy:An,monthYoy:Hn,yearYoy:Gn,calculationType:Pn,momGrowthRate:Zn,momGrowthValue:_n,momOriginalValue:Wn,weekYoyGrowthValue:Bn,monthYoyGrowthValue:Qn,yearYoyGrowthValue:zn,weekYoyOriginalValue:Un,monthYoyOriginalValue:Jn,yearYoyOriginalValue:Kn,weekYoyGrowthRate:qn,monthYoyGrowthRate:Xn,yearYoyGrowthRate:es,growthValue:ts,growthRate:as,differenceRate:os,differenceValue:ns,originalValue:ss,customStyle:ls,color:rs,iconStyle:cs,indexDataFormat:is,decimalPlaces_Format:ds,numberMillennials:us,percentage:ms,millageRate:ys,prefix:hs,suffix:fs,prefixPlaceholder:ps,suffixPlaceholder:Cs,dataPlaceholder:gs,formatErrorMessage:xs,allData:ws,confirm:vs},bs={zh:{translation:qo},en:{translation:ba},ja:{translation:Is}};le.use(Ve).use(ke).init({resources:bs,fallbackLng:"en",interpolation:{escapeValue:!1}});_.bridge.getLanguage().then(e=>{le.language!==e&&le.changeLanguage(e)});function Ce(e){document.body.setAttribute("theme-mode",e)}function Ys(){s.useLayoutEffect(()=>{_.bridge.getTheme().then(e=>{Ce(e.toLocaleLowerCase())}),_.bridge.onThemeChange(e=>{Ce(e.data.theme.toLocaleLowerCase())})},[])}const $s=(e,c)=>{e&&(c(e),setTimeout(()=>{C.setRendered().then()},3e3))};async function Ms(e){s.useEffect(()=>{const c=C.onConfigChange(n=>{const l=n.data.customConfig;$s(l,e)});return()=>{c()}},[])}var j=(e=>(e.CurrentQuarter="CurrentQuarter",e.LastQuarter="LastQuarter",e.CurrentYear="CurrentYear",e.LastYear="LastYear",e.Last14Days="Last14Days",e.Last365Days="Last365Days",e.Last3Months="Last3Months",e.Last6Months="Last6Months",e))(j||{});u("today"),k.Today,u("yesterday"),k.Yesterday,u("currentWeek"),k.CurrentWeek,u("lastWeek"),k.LastWeek,u("currentMonth"),k.CurrentMonth,u("lastMonth"),k.LastMonth,u("currentQuarter"),j.CurrentQuarter,u("lastQuarter"),j.LastQuarter,u("currentYear"),j.CurrentYear,u("lastYear"),j.LastYear,u("last7Days"),k.TheLastWeek,u("last14Days"),j.Last14Days,u("last30Days"),k.TheLastMonth,u("last365Days"),j.Last365Days,u("last3Months"),j.Last3Months,u("last6Months"),j.Last6Months;u("recordsTotal"),u("fieldValue");u("sum"),u("average"),u("max"),u("min");u("mom"),u("weekYoy"),u("monthYoy"),u("yearYoy");const ge=[{label:u("differenceRate"),value:"differenceRate"},{label:u("differenceValue"),value:"differenceValue"},{label:u("originalValue"),value:"originalValue"}],Me=[{id:"1",upIcon:"IconTriangleUp",upIconColor:"green",downIcon:"IconTriangleDown",downIconColor:"red",constIcon:"IconMinus",constIconColor:"black"},{id:"2",upIcon:"IconFilledArrowUp",upIconColor:"green",downIcon:"IconFilledArrowDown",downIconColor:"red",constIcon:"IconMinus",constIconColor:"black"},{id:"3",upIcon:"IconArrowUpRight",upIconColor:"green",downIcon:"IconArrowDownRight",downIconColor:"red",constIcon:"IconMinus",constIconColor:"black"},{id:"4",upIcon:"IconTriangleUp",upIconColor:"red",downIcon:"IconTriangleDown",downIconColor:"green",constIcon:"IconMinus",constIconColor:"black"},{id:"5",upIcon:"IconFilledArrowUp",upIconColor:"red",downIcon:"IconFilledArrowDown",downIconColor:"green",constIcon:"IconMinus",constIconColor:"black"},{id:"6",upIcon:"IconArrowUpRight",upIconColor:"red",downIcon:"IconArrowDownRight",downIconColor:"green",constIcon:"IconMinus",constIconColor:"black"}],Ls={IconMinus:be,IconTriangleUp:Fe,IconTriangleDown:Se,IconFilledArrowUp:Ne,IconFilledArrowDown:Te,IconArrowUpRight:Ee,IconArrowDownRight:Ae},Rs=[{label:u("numberMillennials"),value:"numberMillennials"},{label:u("number"),value:"number"},{label:u("percentage"),value:"percentage"},{label:u("millageRate"),value:"millageRate"}],js={tableId:"",keyIndicatorsFieldId:"",keyIndicatorsRollup:"SUM",datasourceRange:"",momOrYoy:[{momOrYoyDesc:u("differenceRate"),manualSetDesc:!1,momOrYoyCalcMethod:"mom",momOrYoyCalcType:"differenceRate",momOrYoyFieldId:"",indicatorsRollup:"SUM"}],color:"primary",iconStyleId:"1",decimal:0,numberFormat:"number",prefix:"",suffix:""};ue.extend(He);const Ds=e=>e.replace(/\B(?=(\d{3})+$)/g,","),ie=(e,c,n="0.8vmax")=>{const l=Ls[e];return c?t.jsx(l,{style:{fontSize:c,marginRight:n}}):t.jsx(l,{size:"small",style:{marginRight:n}})},Os=(e,c,n)=>{let l="";if(c==="numberMillennials"){const o=e.toFixed(n).split("."),a=Ds(o[0]);l=o.length>1?`${a}.${o[1]}`:a}else c==="number"?l=e.toFixed(n):c==="percentage"?l=(e*100).toFixed(n)+"%":l=(e*1e3).toFixed(n)+"‰";return l},Vs=(e,c,n,l)=>{const o={},a=Me.find(y=>y.id===e);return l===0&&c==="differenceRate"||n===l?(o.icon=a.constIcon,o.color=a.constIconColor):n<l?(o.icon=a.downIcon,o.color=a.downIconColor):(o.icon=a.upIcon,o.color=a.upIconColor),o},ks=(e,c,n,l)=>{let o="";if(e==="differenceRate"){const a=Math.abs((c-n)/n)*100;o=n!==0?`${a.toFixed(l)}%`:""}else if(e==="differenceValue"){const a=Math.abs(c-n);o=a?`${a.toFixed(l)}`:""}else o=`${n.toFixed(l)}`;return o},Le=async e=>{console.log("configFormatter---------",e);let c=[];if(e.tableId){const n=await C.getTableDataRange(e.tableId);if(e.keyIndicatorsFieldId){const l=e.datasourceRange==="All"?n.find(a=>a.type===Ye.ALL):n.find(a=>a.viewId===e.datasourceRange),o={tableId:e.tableId,dataRange:l,series:[{fieldId:e.keyIndicatorsFieldId,rollup:e.keyIndicatorsRollup}]};c.push(o),e.momOrYoy.forEach(a=>{const y={tableId:e.tableId,dataRange:l,series:[{fieldId:a.momOrYoyFieldId,rollup:a.indicatorsRollup}]};c.push(y)})}}return c},Fs=async()=>{const e=await C.getConfig();console.log("get config----",e);const c=e.dataConditions,n=e.customConfig;if(c.length>0){const l=c[0];l.tableId&&!n.tableId.length&&(n.tableId=l.tableId)}return n},Re=async e=>{var l;console.log("getPreviewData---------",e);const c=await Le(e),n=[];for(const o of c){console.log(o,"------init item");const a=await C.getPreviewData(o);console.log("getPreviewData for-------------",o,a);const y=(l=a[1])==null?void 0:l.map(I=>I.value);n.push(y!=null&&y.length?y[0]:0)}return n},Ss=async(e,c)=>{const n=c[0],l=c.slice(1),o=e.momOrYoy.map((y,I)=>{const f=l[I],x=Vs(e.iconStyleId,y.momOrYoyCalcType,n,f);return{desc:y.momOrYoyDesc,calcType:y.momOrYoyCalcType,value:ks(y.momOrYoyCalcType,n,f,e.decimal),color:x.color,icon:x.icon}});return{color:e.color,value:Os(n,e.numberFormat,e.decimal),prefix:e.prefix,suffix:e.suffix,momYoyList:o}},de=async(e,c,n)=>{if(c.filter(o=>o!==void 0).length<=1)return;const l=await Ss(e,c);n(l)},xe=(e,c,n="D-DIN-Bold")=>{const l=document.createElement("span");l.textContent=e,l.style.fontSize=`${c}vmax`,l.style.fontFamily=n,l.style.visibility="hidden",l.style.whiteSpace="nowrap",document.body.appendChild(l);const o=l.offsetWidth;return document.body.removeChild(l),o},we=(e,c,n)=>{if(e===0)return n;let l=n,o=xe(c,l);for(;e<=o;)l-=1,o=xe(c,l);return l},je=[{name:"primary",value:"var(--ccm-chart-N700)"},{name:"blue",value:"var(--ccm-chart-B500)"},{name:"Purple",value:"var(--ccm-chart-I500)"},{name:"green",value:"var(--ccm-chart-G500)"},{name:"cyan",value:"var(--ccm-chart-W500)"},{name:"yellow",value:"var(--ccm-chart-Y500)"},{name:"orange",value:"var(--ccm-chart-O500)"},{name:"red",value:"var(--ccm-chart-R400)"}];function Ns(e){return t.jsx("div",{className:"color-picker",children:je.map(({name:c,value:n})=>t.jsx("div",{onClick:()=>{e.onChange(c)},style:{borderColor:e.name===c?n:"transparent"},className:"color-picker-color-container",children:t.jsx("div",{style:{backgroundColor:n},className:"color-picker-color",children:e.name===c?t.jsx("div",{className:"selected-icon-container"}):null})},c))})}function Ts({renderData:e,mainDomRef:c}){var I;const n=C.state===F.Config||C.state===F.Create,l=s.useRef(null),o=s.useRef(null),a=re(()=>{var g,O;const f=`${e.prefix}${e.value}${e.suffix}`,x=80;let b=26;if(n){const V=((g=l.current)==null?void 0:g.offsetWidth)||0;b=we(V-x,f,26)}else{const V=((O=c.current)==null?void 0:O.offsetWidth)||0;b=we(V-x,f,26)}o.current&&(o.current.style.fontSize=`${b}vmax`)},200),y=()=>{a()};return s.useEffect(()=>(y(),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}),[e]),t.jsx("div",{className:"main-content",ref:l,children:t.jsxs("div",{className:A({"main-content-warp":!0,"is-config":n}),children:[t.jsx("div",{ref:o,className:"main-content-number text-hidden",style:{color:(I=je.find(f=>f.name===e.color))==null?void 0:I.value},children:`${e.prefix}${e.value}${e.suffix}`}),e.momYoyList.map((f,x)=>t.jsxs("div",{className:"main-content-description text-hidden",children:[t.jsx("div",{className:"description-text",children:f.desc}),t.jsxs("div",{className:A("description-index",f.color),children:[f.calcType==="originalValue"?null:ie(f.icon,"1.8vmax",f.value?void 0:"0"),t.jsx("div",{className:"description-index-number",children:f.value})]})]},x))]})})}const ve=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M1.33203 2.66634C1.33203 1.92996 1.92898 1.33301 2.66536 1.33301H13.332C14.0684 1.33301 14.6654 1.92996 14.6654 2.66634V13.333C14.6654 14.0694 14.0684 14.6663 13.332 14.6663H2.66536C1.92899 14.6663 1.33203 14.0694 1.33203 13.333V2.66634ZM2.66536 2.66634V13.333H13.332V2.66634H2.66536Z",fill:"#646A73"}),s.createElement("path",{d:"M8.33203 4.66634C7.96384 4.66634 7.66536 4.96482 7.66536 5.33301C7.66536 5.7012 7.96384 5.99967 8.33203 5.99967H11.332C11.7002 5.99967 11.9987 5.7012 11.9987 5.33301C11.9987 4.96482 11.7002 4.66634 11.332 4.66634H8.33203Z",fill:"#646A73"}),s.createElement("path",{d:"M3.9987 5.33301C3.9987 4.96482 4.29718 4.66634 4.66536 4.66634H5.9987C6.36689 4.66634 6.66536 4.96482 6.66536 5.33301C6.66536 5.7012 6.36689 5.99967 5.9987 5.99967H4.66536C4.29717 5.99967 3.9987 5.7012 3.9987 5.33301Z",fill:"#646A73"}),s.createElement("path",{d:"M8.33203 7.33301C7.96384 7.33301 7.66536 7.63148 7.66536 7.99967C7.66536 8.36786 7.96384 8.66634 8.33203 8.66634H11.332C11.7002 8.66634 11.9987 8.36786 11.9987 7.99967C11.9987 7.63148 11.7002 7.33301 11.332 7.33301H8.33203Z",fill:"#646A73"}),s.createElement("path",{d:"M3.9987 7.99967C3.9987 7.63148 4.29718 7.33301 4.66536 7.33301H5.9987C6.36689 7.33301 6.66536 7.63148 6.66536 7.99967C6.66536 8.36786 6.36689 8.66634 5.9987 8.66634H4.66536C4.29717 8.66634 3.9987 8.36786 3.9987 7.99967Z",fill:"#646A73"}),s.createElement("path",{d:"M8.33203 9.99967C7.96384 9.99967 7.66536 10.2982 7.66536 10.6663C7.66536 11.0345 7.96384 11.333 8.33203 11.333H11.332C11.7002 11.333 11.9987 11.0345 11.9987 10.6663C11.9987 10.2982 11.7002 9.99967 11.332 9.99967H8.33203Z",fill:"#646A73"}),s.createElement("path",{d:"M3.9987 10.6663C3.9987 10.2982 4.29718 9.99967 4.66536 9.99967H5.9987C6.36689 9.99967 6.66536 10.2982 6.66536 10.6663C6.66536 11.0345 6.36689 11.333 5.9987 11.333H4.66536C4.29717 11.333 3.9987 11.0345 3.9987 10.6663Z",fill:"#646A73"})),se=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M5.85044 1.42649C6.21505 1.47773 6.46908 1.81485 6.41784 2.17945L6.16192 4.00039H10.8155L11.0975 1.99389C11.1487 1.62928 11.4858 1.37525 11.8504 1.42649C12.215 1.47773 12.4691 1.81485 12.4178 2.17945L12.1619 4.00039H14.668C15.0362 4.00039 15.3346 4.29887 15.3346 4.66706C15.3346 5.03525 15.0362 5.33373 14.668 5.33373H11.9745L11.3187 10.0004H13.3346C13.7028 10.0004 14.0013 10.2989 14.0013 10.6671C14.0013 11.0353 13.7028 11.3337 13.3346 11.3337H11.1313L10.7478 14.0627C10.6965 14.4273 10.3594 14.6813 9.9948 14.6301C9.63019 14.5788 9.37616 14.2417 9.4274 13.8771L9.78485 11.3337H5.13129L4.74776 14.0627C4.69652 14.4273 4.35941 14.6813 3.9948 14.6301C3.63019 14.5788 3.37616 14.2417 3.4274 13.8771L3.78485 11.3337H1.33464C0.966446 11.3337 0.667969 11.0353 0.667969 10.6671C0.667969 10.2989 0.966446 10.0004 1.33464 10.0004H3.97224L4.6281 5.33373H2.66797C2.29978 5.33373 2.0013 5.03525 2.0013 4.66706C2.0013 4.29887 2.29978 4.00039 2.66797 4.00039H4.81548L5.09748 1.99389C5.14872 1.62928 5.48583 1.37525 5.85044 1.42649ZM9.97224 10.0004L10.6281 5.33373H5.97453L5.31868 10.0004H9.97224Z",fill:"#646A73"})),Es=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M6 8.66634H10C11.8409 8.66634 14 9.95205 14 12.2663V13.333C14 14.0663 13.4 14.6663 12.6667 14.6663H3.33333C2.6 14.6663 2 14.0663 2 13.333V12.2663C2 9.95399 4.15905 8.66634 6 8.66634ZM12.6667 13.333V12.2219C12.6667 10.8209 11.2473 9.99967 10 9.99967H6C4.77998 9.99967 3.33333 10.7808 3.33333 12.2219V13.333H12.6667ZM8 7.99967C6.15905 7.99967 4.66667 6.50729 4.66667 4.66634C4.66667 2.82539 6.15905 1.33301 8 1.33301C9.84095 1.33301 11.3333 2.82539 11.3333 4.66634C11.3333 6.50729 9.84095 7.99967 8 7.99967ZM8 6.66634C9.10457 6.66634 10 5.77091 10 4.66634C10 3.56177 9.10457 2.66634 8 2.66634C6.89543 2.66634 6 3.56177 6 4.66634C6 5.77091 6.89543 6.66634 8 6.66634Z",fill:"#646A73"})),Ie=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M9.3342 3.33346C8.96601 3.33346 8.66753 3.63194 8.66753 4.00013C8.66753 4.36832 8.96601 4.66679 9.3342 4.66679H14.6675C15.0357 4.66679 15.3342 4.36832 15.3342 4.00013C15.3342 3.63194 15.0357 3.33346 14.6675 3.33346H9.3342Z",fill:"#646A73"}),s.createElement("path",{d:"M10.0009 8.00013C10.0009 7.63194 10.2993 7.33346 10.6675 7.33346H14.6675C15.0357 7.33346 15.3342 7.63194 15.3342 8.00013C15.3342 8.36831 15.0357 8.66679 14.6675 8.66679H10.6675C10.2993 8.66679 10.0009 8.36831 10.0009 8.00013Z",fill:"#646A73"}),s.createElement("path",{d:"M12.0009 11.3335C11.6327 11.3335 11.3342 11.6319 11.3342 12.0001C11.3342 12.3683 11.6327 12.6668 12.0009 12.6668H14.6675C15.0357 12.6668 15.3342 12.3683 15.3342 12.0001C15.3342 11.6319 15.0357 11.3335 14.6675 11.3335H12.0009Z",fill:"#646A73"}),s.createElement("path",{d:"M9.86659 14.1484L8.23444 10.1846H3.18136C3.13868 10.1846 3.09685 10.181 3.05616 10.174L1.66589 14.1131C1.53049 14.4968 1.10971 14.698 0.726058 14.5626C0.342408 14.4272 0.141166 14.0064 0.276572 13.6228L4.37565 2.00872C4.71323 1.05226 6.05321 1.01788 6.4394 1.95576L11.2289 13.5875C11.3838 13.9637 11.2044 14.3942 10.8282 14.5491C10.452 14.704 10.0215 14.5246 9.86659 14.1484ZM5.44412 3.40816L3.57241 8.71133H7.62778L5.44412 3.40816Z",fill:"#646A73"})),As=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M11.4701 6.80441C11.7305 6.54406 11.7305 6.12195 11.4701 5.8616C11.2098 5.60125 10.7876 5.60125 10.5273 5.8616L7.33203 9.05687L5.80344 7.52827C5.54309 7.26792 5.12098 7.26792 4.86063 7.52827C4.60028 7.78862 4.60028 8.21073 4.86063 8.47108L6.86063 10.4711C7.12098 10.7314 7.54309 10.7314 7.80344 10.4711L11.4701 6.80441Z",fill:"#646A73"}),s.createElement("path",{d:"M1.33203 2.66634C1.33203 1.92996 1.92898 1.33301 2.66536 1.33301H13.332C14.0684 1.33301 14.6654 1.92996 14.6654 2.66634V13.333C14.6654 14.0694 14.0684 14.6663 13.332 14.6663H2.66536C1.92899 14.6663 1.33203 14.0694 1.33203 13.333V2.66634ZM2.66536 2.66634V13.333H13.332V2.66634H2.66536Z",fill:"#646A73"})),Hs=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M7.33464 4.33301C7.33464 2.67373 8.68674 1.33301 10.3412 1.33301C11.9884 1.33301 13.3346 2.6679 13.3346 4.31999V4.33301C13.3346 4.7012 13.0362 4.99967 12.668 4.99967C12.2998 4.99967 12.0013 4.7012 12.0013 4.33301V4.31999C12.0013 3.40913 11.2569 2.66634 10.3412 2.66634C9.41826 2.66634 8.66797 3.41496 8.66797 4.33301V6.66634H11.3346C11.7028 6.66634 12.0013 6.96482 12.0013 7.33301C12.0013 7.7012 11.7028 7.99967 11.3346 7.99967H8.66797V11.6663C8.66797 13.3256 7.31587 14.6663 5.66144 14.6663C4.0142 14.6663 2.66797 13.3314 2.66797 11.6794V11.6663C2.66797 11.2982 2.96645 10.9997 3.33464 10.9997C3.70283 10.9997 4.0013 11.2982 4.0013 11.6663V11.6794C4.0013 12.5902 4.74573 13.333 5.66144 13.333C6.58434 13.333 7.33464 12.5844 7.33464 11.6663L7.33464 7.99967H5.33464C4.96645 7.99967 4.66797 7.7012 4.66797 7.33301C4.66797 6.96482 4.96645 6.66634 5.33464 6.66634H7.33464V4.33301Z",fill:"#646A73"})),Gs=e=>s.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M13.332 2.66634H2.66536V13.333H7.33203V14.6663H2.66536C1.92899 14.6663 1.33203 14.0694 1.33203 13.333V2.66634C1.33203 1.92996 1.92898 1.33301 2.66536 1.33301H13.332C14.0684 1.33301 14.6654 1.92996 14.6654 2.66634V6.66634H13.332V2.66634Z",fill:"#646A73"}),s.createElement("path",{d:"M4.66536 4.33301C4.29717 4.33301 3.9987 4.63148 3.9987 4.99967C3.9987 5.36786 4.29718 5.66634 4.66536 5.66634H9.9987C10.3669 5.66634 10.6654 5.36786 10.6654 4.99967C10.6654 4.63148 10.3669 4.33301 9.9987 4.33301H4.66536Z",fill:"#646A73"}),s.createElement("path",{d:"M3.9987 7.66634C3.9987 7.29815 4.29717 6.99967 4.66536 6.99967H6.9987C7.36689 6.99967 7.66536 7.29815 7.66536 7.66634C7.66536 8.03453 7.36689 8.33301 6.9987 8.33301H4.66536C4.29717 8.33301 3.9987 8.03453 3.9987 7.66634Z",fill:"#646A73"}),s.createElement("path",{d:"M4.66536 9.66634C4.29717 9.66634 3.9987 9.96482 3.9987 10.333C3.9987 10.7012 4.29717 10.9997 4.66536 10.9997H6.33203C6.70022 10.9997 6.9987 10.7012 6.9987 10.333C6.9987 9.96482 6.70022 9.66634 6.33203 9.66634H4.66536Z",fill:"#646A73"}),s.createElement("path",{d:"M13.958 12.7197C14.4012 12.1538 14.6654 11.4409 14.6654 10.6663C14.6654 8.82539 13.173 7.33301 11.332 7.33301C9.49108 7.33301 7.9987 8.82539 7.9987 10.6663C7.9987 12.5073 9.49108 13.9997 11.332 13.9997C11.9165 13.9997 12.4658 13.8492 12.9434 13.585L14.0752 14.887C14.3168 15.1649 14.7379 15.1943 15.0158 14.9527C15.2936 14.7112 15.3231 14.2901 15.0815 14.0122L13.958 12.7197ZM11.332 12.6663C10.2275 12.6663 9.33203 11.7709 9.33203 10.6663C9.33203 9.56177 10.2275 8.66634 11.332 8.66634C12.4366 8.66634 13.332 9.56177 13.332 10.6663C13.332 11.7709 12.4366 12.6663 11.332 12.6663Z",fill:"#646A73"}));function Ps({config:e,datasourceRange:c,setConfig:n,tableList:l,tableFields:o}){const{t:a}=me(),[y,I]=s.useState(e.tableId),[f,x]=s.useState(o),[b,g]=s.useState(e.keyIndicatorsFieldId),[O,H]=s.useState(e.keyIndicatorsRollup??Z.SUM),[V,W]=s.useState(c),[B,Q]=s.useState(e.datasourceRange),S=[{keyOfName:"sum",type:Z.SUM},{keyOfName:"average",type:Z.AVERAGE},{keyOfName:"max",type:Z.MAX},{keyOfName:"min",type:Z.MIN}];s.useEffect(()=>{I(e.tableId)},[e.tableId]),s.useEffect(()=>{Q(e.datasourceRange)},[e.datasourceRange]),s.useEffect(()=>{g(e.keyIndicatorsFieldId)},[e.keyIndicatorsFieldId]),s.useEffect(()=>{x(o)},[o]),s.useEffect(()=>{W(c)},[c]);const J=async r=>{e.tableId=r,I(r);const i=await C.getTableDataRange(r);W(i),e.keyIndicatorsFieldId="",e.datasourceRange="All",e.momOrYoy.forEach(v=>{v.momOrYoyFieldId=""}),g(""),Q("All");const p=await(await U.getTable(r)).getFieldMetaList();x(p);const Y=p.filter(v=>v.type===2);Y.forEach((v,M)=>{M===0?e.keyIndicatorsFieldId=Y[0].id:M-1<e.momOrYoy.length&&(e.momOrYoy[M-1].momOrYoyFieldId=Y[M].id)}),console.log(e,"after change table-----------"),n({...e})},K=r=>{e.datasourceRange=r,n({...e})},h=(r,i)=>{n({...e,[r]:i}),g(i)},m=(r,i,d,p)=>{if(r={...r,[i]:d},i==="momOrYoyDesc"&&(r.manualSetDesc=!0),i==="momOrYoyCalcType"){const Y=ge.find(v=>v.value===r.momOrYoyCalcType);Y&&(r.momOrYoyDesc=Y.label)}e.momOrYoy[p]=r,n({...e})},w=s.useRef(null),L=()=>{const r={momOrYoyDesc:a("momGrowthRate"),momOrYoyFieldId:"",manualSetDesc:!1,momOrYoyCalcMethod:"mom",momOrYoyCalcType:"differenceRate",indicatorsRollup:"SUM"};e.momOrYoy.push(r),n({...e}),setTimeout(()=>{var i;(i=w.current)==null||i.scrollIntoView({behavior:"smooth"})},0)},N=r=>{e.momOrYoy.splice(r,1),n({...e})},R=r=>{const i=S.find(p=>p.type===r),d=(i==null?void 0:i.keyOfName)??"";return a(d)},q=r=>t.jsxs("div",{style:{display:"flex",alignItems:"center"},className:"custom-option-render",children:[t.jsx($,{svg:t.jsx(ve,{})}),t.jsx("span",{style:{marginLeft:8},children:r.label})]}),X=r=>{switch(r){case 1:return t.jsx($,{svg:t.jsx(Ie,{})});case 2:return t.jsx($,{svg:t.jsx(se,{})});case 3:return t.jsx($,{svg:t.jsx(As,{})});case 11:return t.jsx($,{svg:t.jsx(Es,{})});case 19:return t.jsx($,{svg:t.jsx(Gs,{})});case 20:return t.jsx($,{svg:t.jsx(Hs,{})});default:return t.jsx($,{svg:t.jsx(Ie,{})})}},ye=r=>{const{disabled:i,selected:d,label:p,value:Y,focused:v,className:M,style:G,onMouseEnter:P,onClick:te,empty:fe,emptyContent:T,...ae}=r,oe=ee({"custom-option-render":!0,"custom-option-render-focused":v,"custom-option-render-disabled":i,"custom-option-render-selected":d});return t.jsxs("div",{style:{...G,display:"flex",flexDirection:"row",padding:"8px 12px",cursor:"pointer",alignItems:"center"},className:oe,onClick:()=>te(),onMouseEnter:z=>P(),children:[t.jsx($,{svg:t.jsx(ve,{})}),t.jsx("span",{style:{marginLeft:8},children:p}),d?t.jsx(ne,{style:{marginLeft:"auto",marginRight:"0"}}):""]})},ee=r=>{let i=[];return Object.keys(r).forEach(d=>{r[d]&&i.push(d)}),i.join(" ")},he=r=>{const{disabled:i,selected:d,label:p,value:Y,focused:v,style:M,onMouseEnter:G,onClick:P,empty:te,emptyContent:fe,inputValue:T,type:ae,...oe}=r,z=ee({"custom-option-render":!0,"custom-option-render-focused":v,"custom-option-render-disabled":i,"custom-option-render-selected":d});return T.length===0||p.toUpperCase().includes(T.toUpperCase())?t.jsxs("div",{style:{...M,opacity:i?"0.6":"1.0",display:"flex",flexDirection:"row",padding:"8px 12px",cursor:"pointer",alignItems:"center"},className:z,onClick:()=>P(),onMouseEnter:Oe=>G(),children:[X(ae),t.jsx("span",{style:{marginLeft:8},children:p}),d?t.jsx(ne,{style:{marginLeft:"auto",marginRight:"0"}}):""]}):""},De=r=>{const{disabled:i,selected:d,label:p,value:Y,focused:v,style:M,onMouseEnter:G,onClick:P,empty:te,emptyContent:fe,inputValue:T,type:ae,...oe}=r,z=ee({"custom-option-render":!0,"custom-option-render-focused":v,"custom-option-render-disabled":i,"custom-option-render-selected":d});return T.length===0||p.toUpperCase().includes(T.toUpperCase())?t.jsxs("div",{style:{...M,opacity:i?"0.6":"1.0",display:"flex",flexDirection:"row",padding:"8px 12px",cursor:"pointer",alignItems:"center"},className:z,onClick:()=>P(),onMouseEnter:Oe=>G(),children:[t.jsx("span",{style:{marginLeft:8},children:p}),d?t.jsx(ne,{style:{marginLeft:"auto",marginRight:"0"}}):""]}):""};return t.jsxs("div",{className:"form-main",children:[t.jsx("div",{className:"form-title",children:a("dataSource")}),t.jsx("div",{className:"form-item",children:t.jsx(D,{filter:!0,style:{width:"100%"},optionList:l,value:y,renderSelectedItem:q,renderOptionItem:ye,onChange:J})},"dataSource"),t.jsx("div",{className:"form-title",children:a("dataRange")}),t.jsx("div",{className:"form-item",children:t.jsx(D,{filter:!0,renderSelectedItem:q,renderOptionItem:ye,optionList:V.map(r=>r.type===Ye.ALL?{value:"All",label:a("view_all")}:{value:r.viewId,label:r.viewName}),defaultValue:B,value:B,onChange:r=>{K(r)}})}),t.jsx(Ge,{style:{borderColor:"var(--divider)",margin:"20px 0 20px 0"}}),t.jsx("div",{className:"form-title",children:a("key_indicators")}),t.jsx("div",{className:"form-item",children:t.jsx(D,{className:"drop-down-select",placeholder:a("key_indicators"),prefix:t.jsx($,{svg:t.jsx(se,{})}),showArrow:!1,filter:!0,suffix:t.jsx(E,{className:"select-suffix",position:"bottomRight",trigger:"click",stopPropagation:!0,clickToHide:!0,render:t.jsx(E.Menu,{children:S.map(r=>t.jsx(E.Item,{onClick:i=>{const d=i.target.textContent,p=S.find(Y=>a(Y.keyOfName)===d);p&&(console.log(p.type),e.keyIndicatorsRollup=p.type,n({...e}),H(p.type))},children:a(r.keyOfName)},r.type))}),children:t.jsx(pe,{className:"drop-down-tag",onClick:r=>{r.stopPropagation()},children:R(O)})}),defaultValue:b,value:b,onSelect:r=>{b===r?h("keyIndicatorsFieldId",""):h("keyIndicatorsFieldId",r)},optionList:f.map(r=>({value:r.id,label:r.name,type:r.type,disabled:r.type!==2})),renderOptionItem:he})}),t.jsxs("div",{className:"form-title",children:[t.jsx("span",{children:a("auxiliary_index")}),t.jsx($e,{disabled:e.momOrYoy.length>=4,theme:"borderless",icon:t.jsx(Pe,{size:"small"}),style:{fontWeight:"normal"},onClick:L,children:a("add_index")})]}),(e.momOrYoy??[]).map((r,i)=>t.jsxs("div",{className:"form-item bg-grey field-card",children:[e.momOrYoy.length>1&&t.jsx("div",{className:"icon-delete",onClick:()=>{N(i)},children:t.jsx(Ze,{size:"small"})}),t.jsx("div",{className:"form-subTitle",children:a("field")}),t.jsx(D,{prefix:t.jsx($,{svg:t.jsx(se,{})}),placeholder:a("auxiliary_index"),position:"top",defaultValue:r.momOrYoyFieldId,value:r.momOrYoyFieldId,filter:!0,onSelect:d=>{r.momOrYoyFieldId===d?m(r,"momOrYoyFieldId","",i):m(r,"momOrYoyFieldId",d,i)},optionList:f.map(d=>({value:d.id,label:d.name,type:d.type,disabled:d.type!==2})),renderOptionItem:he,showArrow:!1,suffix:t.jsx(E,{className:"select-suffix",position:"bottomRight",trigger:"click",stopPropagation:!0,clickToHide:!0,render:t.jsx(E.Menu,{children:S.map(d=>t.jsx(E.Item,{onClick:p=>{const Y=p.target.textContent,v=S.find(M=>a(M.keyOfName)===Y);v&&(m(r,"indicatorsRollup",v.type,i),n({...e}))},children:a(d.keyOfName)},d.type))}),children:t.jsx(pe,{className:"drop-down-tag",onClick:d=>{d.stopPropagation()},children:R(r.indicatorsRollup)})})}),t.jsx("div",{className:"form-subTitle",children:a("description")}),t.jsx(ce,{value:r.momOrYoyDesc,onChange:d=>m(r,"momOrYoyDesc",d,i)}),t.jsx("div",{className:"form-subTitle",children:a("calculationType")}),t.jsx(D,{position:"top",optionList:ge,renderOptionItem:De,defaultValue:r.momOrYoyCalcType,value:r.momOrYoyCalcType,onChange:d=>m(r,"momOrYoyCalcType",d,i)}),t.jsx("div",{ref:w})]},i))]})}function Zs({config:e,setConfig:c}){const{t:n}=me(),l=(a,y)=>{c({...e,[a]:y})},o=a=>`${a}`.replace(/\D/g,"");return t.jsxs("div",{className:"form-main",children:[t.jsx("div",{className:"form-title",children:n("color")}),t.jsx("div",{className:"form-item",style:{margin:"6px 0 18px 0"},children:t.jsx(Ns,{onChange:a=>{l("color",a)},name:e.color})}),t.jsx("div",{className:"form-title",children:n("iconStyle")}),t.jsx("div",{className:"form-item",children:t.jsx(D,{value:e.iconStyleId,onChange:a=>{l("iconStyleId",a)},children:Me.map(a=>t.jsx(D.Option,{value:a.id,children:t.jsxs("div",{className:"index-icon",children:[t.jsxs("div",{className:A("index-icon-item",a.upIconColor),children:[ie(a.upIcon),t.jsx("div",{className:"number",children:"10"})]}),t.jsxs("div",{className:A("index-icon-item",a.constIconColor),children:[t.jsx(be,{size:"small"}),t.jsx("div",{className:"number",children:"0"})]}),t.jsxs("div",{className:A("index-icon-item",a.downIconColor),children:[ie(a.downIcon),t.jsx("div",{className:"number",children:"10"})]})]})},a.id))})}),t.jsx("div",{className:"form-title",children:n("indexDataFormat")}),t.jsxs("div",{className:"form-item",children:[t.jsx("div",{className:"form-subTitle",children:n("decimalPlaces_Format")}),t.jsxs("div",{className:"flex-between",children:[t.jsx(_e,{style:{marginRight:"10px",flex:1},value:e.decimal,formatter:o,onNumberChange:a=>{l("decimal",a)},min:0,max:5}),t.jsx(D,{value:e.numberFormat,style:{flex:1},onChange:a=>{l("numberFormat",a)},children:Rs.map(a=>t.jsx(D.Option,{value:a.value,children:a.label},a.value))})]})]}),t.jsxs("div",{className:"flex-between",children:[t.jsxs("div",{className:"form-item",style:{marginRight:"10px"},children:[t.jsx("div",{className:"form-subTitle",children:n("prefix")}),t.jsx(ce,{value:e.prefix,placeholder:n("prefixPlaceholder"),onChange:a=>{l("prefix",a)}})]}),t.jsxs("div",{className:"form-item",children:[t.jsx("div",{className:"form-subTitle",children:n("suffix")}),t.jsx(ce,{value:e.suffix,placeholder:n("suffixPlaceholder"),onChange:a=>{l("suffix",a)}})]})]})]})}function _s({setRenderData:e,initializeConfig:c}){const{t:n}=me(),l=[{key:"1",tab:n("type_Date")},{key:"2",tab:n("customStyle")}],[o,a]=s.useState(c),[y,I]=s.useState([]),[f,x]=s.useState([]),[b,g]=s.useState([]);Ms(a).then();const O=async()=>{if(console.log("save config",JSON.stringify(o),JSON.parse(JSON.stringify(o))),!o.keyIndicatorsFieldId){Qe.error(n("dataPlaceholder"));return}const h=await Le(o);await C.saveConfig({customConfig:o,dataConditions:h})},H=s.useCallback(async()=>{const h=await U.getTableList(),m=[];for(const w of h){const L=await w.getName();m.push({value:w.id,label:L})}return m},[]),V=async(h,m)=>{let w;const L=h[m];if(!L)return;const R=await(await U.getTable(L.value)).getFieldMetaList();if(R.filter(X=>X.type===2).length>=2)return w={tableId:L.value,fields:R},w;if(m<h.length-1)return await V(h,m+1)},W=async(h,m)=>{const w=await V(h,0);if(!w)return;m.tableId=w.tableId;const L=await C.getTableDataRange(m.tableId);I(L),m.datasourceRange||(m.datasourceRange="All");const N=w.fields.filter(R=>R.type===2);m.keyIndicatorsFieldId=N[0].id,m.momOrYoy[0].momOrYoyFieldId=N[1].id,x(w.fields),a({...m})},B=async()=>{var R;const h=await H();console.log(h,"----"),g(h);const m={...o};if((C.state===F.Create||m.tableId.length===0)&&(m.tableId=(R=h[0])==null?void 0:R.value,await W(h,m),console.log(m,"渲染初始化数据")),!m.tableId){a({...m});return}const w=await C.getTableDataRange(m.tableId);I(w),m.datasourceRange||(m.datasourceRange="All"),console.log(o.datasourceRange,"--------------------");const N=await(await U.getTable(m.tableId)).getFieldMetaList();x(N),a({...m})};s.useEffect(()=>{B().then()},[]);const[Q,S]=s.useState([]),J=re(async()=>{if(!o.tableId)return;const h=await Re(o);S(h),await de(o,h,e)},200);s.useEffect(()=>{J()},[o.tableId,o.keyIndicatorsFieldId,o.keyIndicatorsRollup,o.datasourceRange,JSON.stringify(o.momOrYoy)]);const K=re(()=>{o.tableId&&de(o,Q,e).then()},200);return s.useEffect(()=>{K()},[o.color,o.iconStyleId,o.decimal,o.numberFormat,o.prefix,o.suffix]),t.jsxs("div",{className:"main-config-panel left-border",children:[t.jsx("div",{className:"form",children:t.jsx(We,{defaultActiveKey:"1",children:l.map(h=>t.jsxs(Be,{tab:h.tab,itemKey:h.key,children:[h.key==="1"&&t.jsx(Ps,{config:o,datasourceRange:y,tableFields:f,setConfig:a,tableList:b}),h.key==="2"&&t.jsx(Zs,{config:o,setConfig:a})]},h.key))})}),t.jsx($e,{className:"btn",theme:"solid",onClick:O,children:n("confirm")})]})}const Ws=e=>s.createElement("svg",{width:121,height:120,viewBox:"0 0 121 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{d:"M77.0437 70.0795L76.8283 69.9809L62.359 81.0316C61.1703 81.9395 59.5743 82.1082 58.2219 81.4691L8.21977 57.8358C6.85883 57.1926 6.6695 55.3331 7.87286 54.4288L21.5603 44.1424L42.6416 7.61167C43.6825 5.80802 45.933 5.1047 47.8157 5.99472L99.1782 30.2764C99.5333 30.4442 99.8617 30.6635 100.153 30.9271L114.93 44.3024C116.326 45.5669 116.652 47.6347 115.71 49.2668L112.334 55.1195L94.3026 86.3444L91.4574 102.279C91.1814 103.825 89.3131 104.465 88.1478 103.412L74.8172 91.37C73.7729 90.4267 73.3012 89.004 73.575 87.6236L77.0527 70.0882L77.0437 70.0795Z",fill:"#BBBFC4",fillOpacity:.45}),s.createElement("path",{d:"M99.6143 30.5555C99.3748 30.4182 99.0692 30.5011 98.9319 30.7407L76.8319 69.3007C76.6946 69.5403 76.7775 69.8458 77.0171 69.9831C77.2567 70.1205 77.5622 70.0375 77.6995 69.798L99.7995 31.238C99.9368 30.9984 99.8539 30.6929 99.6143 30.5555Z",fill:"#8F959E"}),s.createElement("path",{d:"M23.1481 44.609C23.2643 44.3585 23.5616 44.2497 23.8121 44.3659L74.6821 67.9659C74.9326 68.0821 75.0415 68.3794 74.9253 68.6299C74.809 68.8804 74.5118 68.9892 74.2613 68.873L23.3913 45.273C23.1408 45.1568 23.0319 44.8595 23.1481 44.609Z",fill:"#8F959E"}),s.createElement("path",{d:"M79.0919 70.7157C79.2872 70.5205 79.6038 70.5206 79.799 70.7159L93.429 84.3559C93.6242 84.5512 93.6241 84.8678 93.4287 85.063C93.2334 85.2582 92.9168 85.2581 92.7216 85.0628L79.0916 71.4228C78.8964 71.2274 78.8966 70.9108 79.0919 70.7157Z",fill:"#8F959E"}),s.createElement("path",{d:"M12.2976 85.0758C12.3936 85.3407 12.6793 85.4857 12.9356 85.3997L26.9261 80.7052C27.1824 80.6192 27.3124 80.3347 27.2164 80.0698C27.1204 79.8049 26.8348 79.6598 26.5784 79.7458L12.588 84.4403C12.3316 84.5263 12.2016 84.8108 12.2976 85.0758Z",fill:"#002270"}),s.createElement("path",{d:"M29.1592 93.1365C29.3988 93.2817 29.7003 93.2068 29.8325 92.9691L33.407 86.5435C33.5392 86.3058 33.4521 85.9954 33.2124 85.8502C32.9728 85.705 32.6713 85.7799 32.5391 86.0176L28.9646 92.4431C28.8324 92.6808 28.9195 92.9912 29.1592 93.1365Z",fill:"#002270"}),s.createElement("path",{d:"M40.8525 98.3544C41.1176 98.436 41.3879 98.2863 41.4564 98.0199L43.2095 91.2039C43.278 90.9376 43.1187 90.6556 42.8537 90.574C42.5887 90.4924 42.3183 90.6421 42.2498 90.9084L40.4967 97.7245C40.4282 97.9908 40.5875 98.2728 40.8525 98.3544Z",fill:"#002270"}),s.createElement("path",{d:"M22.0441 15.2369C21.8072 15.9701 20.5295 20.0796 19.3945 26.224C21.5668 16.8434 31.2357 16.1999 38.251 15.2661L42.1562 8.44622C29.0405 6.83319 23.1995 12.7542 22.0441 15.2369Z",fill:"#002270"}),s.createElement("path",{d:"M20.9225 22.5347C21.0509 23.0541 21.2118 23.5665 21.4048 24.0727C22.4949 26.9319 24.5749 29.5086 27.3744 31.9806C32.5064 36.5122 40.3119 40.9009 49.6257 46.1376C50.081 46.3936 50.5399 46.6516 51.0022 46.9117L47.2365 51.6058C36.8022 45.6411 29.3354 41.0762 24.7907 36.9181C22.4741 34.7986 20.9858 32.8446 20.2334 30.935C19.4932 29.0563 19.4397 27.1569 20.1106 25.0658L20.9225 22.5347ZM19.1584 24.7603C16.2101 33.9506 25.8848 40.5791 47.4822 52.8976L52.5195 46.6184C52.2236 46.4517 51.9293 46.286 51.6364 46.1211C51.1381 45.8407 50.6441 45.5629 50.1547 45.2877C33.7141 36.0426 22.3614 29.6586 21.5906 20.4522C21.4473 18.7409 21.6697 16.9321 22.293 14.9893L19.1584 24.7603Z",fill:"#002270"}),s.createElement("path",{d:"M115.229 86.0665C114.789 83.8931 108.017 74.6118 102.273 72.5762L105.411 67.1211C111.08 69.772 115.204 74.3925 115.21 77.1715C115.217 80.033 115.274 83.5659 115.229 86.0665Z",fill:"#002270"}),s.createElement("path",{d:"M83.6606 91.9654L83.6445 85.1843C89.7317 86.0039 95.2361 86.9841 103.493 86.429C111.836 85.8682 115.218 81.8932 115.209 77.8652L115.229 86.394C114.8 88.8997 110.898 92.9466 103.944 93.2258C96.9901 93.5049 90.5864 93.0806 83.6606 91.9654Z",fill:"#33D6C0"}),s.createElement("path",{d:"M66.6627 105.195C62.5108 103.955 59.5924 102.772 57.5718 101.783L57.4336 94.708C60.3869 96.514 63.8677 97.5406 67.3071 98.4525C70.8133 99.3823 75.833 100.663 81.0725 101.913L81.0886 108.73C75.8307 107.597 70.5171 106.347 66.6627 105.195Z",fill:"#336DF4"}),s.createElement("path",{d:"M85.2035 109.546L85.1875 102.765C91.2747 103.585 96.779 104.565 105.036 104.01C113.379 103.449 116.761 99.4743 116.752 95.4463L116.772 103.975C116.343 106.481 112.441 110.528 105.487 110.807C98.5331 111.086 92.1294 110.662 85.2035 109.546Z",fill:"#336DF4"}));function Bs(){Ys();const e=C.state===F.Config||C.state===F.Create,[c,n]=s.useState(!0),[l,o]=s.useState("light"),[a,y]=s.useState(js),[I,f]=s.useState({color:"primary",value:"",prefix:"",suffix:"",momYoyList:[]}),x=s.useRef(null),b=async()=>{const g=await Fs();if(console.log("render main get config",g),y(g),g.tableId.length>0){const O=await Re(g);await de(g,O,f)}};return s.useEffect(()=>{_.bridge.getTheme().then(g=>{o(g)}),F.Create!==C.state?b().then(()=>{n(!1)}):n(!1),C.onDataChange(g=>{F.Create!==C.state&&b().then()}),C.onConfigChange(g=>{F.Create!==C.state&&b().then()})},[]),c?t.jsx("div",{style:{width:"100%",height:"100%",display:"grid",alignItems:"center",justifyItems:"center"},children:t.jsxs("div",{style:{width:"max-content",height:"max-content",display:"flex",flexDirection:"column",alignItems:"center",rowGap:"10px",justifyItems:"center"},children:[t.jsx($,{svg:t.jsx(Ws,{})}),t.jsx("div",{style:{textAlign:"center",fontSize:"16px",color:l==="light"?"#1F2329":"#FFFFFF"},children:"加载中..."})]})}):t.jsxs("main",{className:A(e?"top-border":"","main"),ref:x,children:[t.jsx(Ts,{renderData:I,mainDomRef:x}),e&&t.jsx(_s,{setRenderData:f,initializeConfig:a})]})}ue.locale("en-us");function Qs(e){const[c,n]=s.useState(ze);return s.useEffect(()=>{if(e.neverShowBanner)return;const l=new Promise((o,a)=>{setTimeout(()=>{a(!1)},3e3)});Promise.race([_.bridge.getLanguage(),l]).then(o=>{o==="zh"&&(n(Ue),ue.locale("zh-cn")),o==="ja"&&n(Je)}).catch(o=>{console.error(o)})},[]),e.neverShowBanner?e.children||null:t.jsx(Ke,{locale:c,children:e.children})}const zs=qe([{path:"/",element:t.jsx(Bs,{})}]),Us=Xe.createRoot(document.getElementById("root"));Us.render(t.jsx(Qs,{children:t.jsx(et,{router:zs})}));
